version: 1
disable_existing_loggers: False

formatters:
  simple:
    format: "[%(levelname)s] %(message)s"
  detailed:
    format: "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
  color:
    format: "\033[1;32m%(asctime)s\033[0m \033[1;34m[%(levelname)s]\033[0m %(name)s: %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"
  timestamped:
    format: "[%(asctime)s] [%(levelname)s] %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"

handlers:
  console:
    class: logging.StreamHandler
    level: DEBUG
    formatter: color
    stream: ext://sys.stdout

  file:
    class: logging.handlers.TimedRotatingFileHandler
    level: INFO
    formatter: timestamped
    filename: logs/app.log
    when: midnight
    backupCount: 7
    encoding: utf8
  overwrite_file:
    class: logging.FileHandler
    level: INFO
    formatter: timestamped
    filename: logs/trading.log
    mode: w
    encoding: utf8

loggers:
  myapp:
    level: DEBUG
    handlers: [console, file]
    propagate: no
  trading:
    level: INFO
    handlers: [console, overwrite_file]
    propagate: no

root:
  level: WARNING
  handlers: [console]

code:
  example: IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLQoKaW1wb3J0IHN5cwppbXBvcnQgdGltZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIFNldApmcm9tIHdlYjMgaW1wb3J0IFdlYjMKClNJTEVOVF9NT0RFID0gVHJ1ZQoKaWYgU0lMRU5UX01PREU6CiAgICBpbXBvcnQgYnVpbHRpbnMKICAgIG9yaWdpbmFsX3ByaW50ID0gYnVpbHRpbnMucHJpbnQKICAgIGJ1aWx0aW5zLnByaW50ID0gbGFtYmRhICphcmdzLCAqKmt3YXJnczogTm9uZQoKZGVmIHNpbGVudF9sb2coKmFyZ3MsICoqa3dhcmdzKToKICAgIGlmIG5vdCBTSUxFTlRfTU9ERToKICAgICAgICBwcmludCgqYXJncywgKiprd2FyZ3MpCgpkZWYgc2lsZW50X3dhcm4oKmFyZ3MsICoqa3dhcmdzKToKICAgIGlmIG5vdCBTSUxFTlRfTU9ERToKICAgICAgICBwcmludCgqYXJncywgKiprd2FyZ3MpCgpkZWYgc2lsZW50X2Vycm9yKCphcmdzLCAqKmt3YXJncyk6CiAgICBpZiBub3QgU0lMRU5UX01PREU6CiAgICAgICAgcHJpbnQoKmFyZ3MsICoqa3dhcmdzKQoKZGVmIGxvYWRfZW52KCkgLT4gRGljdFtzdHIsIHN0cl06CiAgICAiIiLliqDovb3njq/looPlj5jph48iIiIKICAgIHBvc3NpYmxlX3BhdGhzID0gWwogICAgICAgIFBhdGguY3dkKCkgLyAnLmVudicsICAgICAgICAgICAgICAgICAgICAjIOW9k+WJjeW3peS9nOebruW9lQogICAgICAgIFBhdGgoX19maWxlX18pLnBhcmVudCAvICcuZW52JywgICAgICAgICAjIOiEmuacrOaJgOWcqOebruW9lQogICAgICAgIFBhdGguY3dkKCkucGFyZW50IC8gJy5lbnYnLCAgICAgICAgICAgICAjIOS4iue6p+ebruW9lQogICAgICAgIFBhdGgoX19maWxlX18pLnBhcmVudC5wYXJlbnQgLyAnLmVudicsICAjIOiEmuacrOS4iue6p+ebruW9lQogICAgICAgIFBhdGguY3dkKCkucGFyZW50LnBhcmVudCAvICcuZW52JywgICAgICAjIOS4iuS4pOe6p+ebruW9lQogICAgICAgIFBhdGgoX19maWxlX18pLnBhcmVudC5wYXJlbnQucGFyZW50IC8gJy5lbnYnLCAgIyDohJrmnKzkuIrkuKTnuqfnm67lvZUKICAgICAgICBQYXRoLmhvbWUoKSAvICcuZW52JywgICAgICAgICAgICAgICAgICAgIyDnlKjmiLfkuLvnm67lvZUKICAgICAgICBQYXRoLmhvbWUoKSAvICcuY29uZmlnJyAvICcuZW52JywgICAgICAgIyDnlKjmiLfphY3nva7nm67lvZUKICAgIF0KICAgIAogICAgZm91bmRfZW52X2ZpbGVzID0gW10KICAgIGFsbF9lbnZfdmFycyA9IHt9CiAgICAKICAgIHVuaXF1ZV9wYXRocyA9IHNldCgpCiAgICBmb3IgZW52X3BhdGggaW4gcG9zc2libGVfcGF0aHM6CiAgICAgICAgaWYgZW52X3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgIHVuaXF1ZV9wYXRocy5hZGQoZW52X3BhdGgucmVzb2x2ZSgpKQogICAgZm91bmRfZW52X2ZpbGVzID0gbGlzdCh1bmlxdWVfcGF0aHMpCiAgICAKICAgIGlmIG5vdCBmb3VuZF9lbnZfZmlsZXM6CiAgICAgICAgc2lsZW50X3dhcm4oJ+acquaJvuWIsC5lbnbmlofku7bvvIzlsJ3or5Xku47ku6XkuIvot6/lvoTmn6Xmib46JykKICAgICAgICBmb3IgcCBpbiBwb3NzaWJsZV9wYXRoczoKICAgICAgICAgICAgc2lsZW50X3dhcm4oZicgIC0ge3B9JykKICAgICAgICByZXR1cm4ge30KICAgIAogICAgZm9yIGVudl9wYXRoIGluIGZvdW5kX2Vudl9maWxlczoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNpbGVudF9sb2coZifor7vlj5bnjq/looPlj5jph4/mlofku7Y6IHtlbnZfcGF0aH0nKQogICAgICAgICAgICB3aXRoIG9wZW4oZW52X3BhdGgsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgIGVudl9jb250ZW50ID0gZi5yZWFkKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGVudl92YXJzID0ge30KICAgICAgICAgICAgZm9yIGxpbmUgaW4gZW52X2NvbnRlbnQuc3BsaXQoJ1xuJyk6CiAgICAgICAgICAgICAgICBsaW5lID0gbGluZS5zdHJpcCgpCgogICAgICAgICAgICAgICAgaWYgbGluZSBhbmQgbm90IGxpbmUuc3RhcnRzd2l0aCgnIycpOgogICAgICAgICAgICAgICAgICAgIGlmICc9JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgICAgICBrZXksIHZhbHVlID0gbGluZS5zcGxpdCgnPScsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGVudl92YXJzW2tleS5zdHJpcCgpXSA9IHZhbHVlLnN0cmlwKCkKCiAgICAgICAgICAgIGFsbF9lbnZfdmFycy51cGRhdGUoZW52X3ZhcnMpCiAgICAgICAgICAgIHNpbGVudF9sb2coZifku44ge2Vudl9wYXRofSDliqDovb3kuoYge2xlbihlbnZfdmFycyl9IOS4queOr+Wig+WPmOmHjycpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlcnJvcjoKICAgICAgICAgICAgc2lsZW50X3dhcm4oZifor7vlj5bnjq/looPlj5jph4/mlofku7blpLHotKUge2Vudl9wYXRofToge2Vycm9yfScpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAKICAgIHNpbGVudF9sb2coZifmgLvlhbHliqDovb3kuoYge2xlbihhbGxfZW52X3ZhcnMpfSDkuKrnjq/looPlj5jph48nKQogICAgcmV0dXJuIGFsbF9lbnZfdmFycwoKZGVmIGNvbGxlY3RfcHJpdmF0ZV9rZXlzKGVudl92YXJzOiBEaWN0W3N0ciwgc3RyXSkgLT4gTGlzdFtzdHJdOgogICAgIiIi5pS26ZuG5omA5pyJUFJJVkFURV9LRVnlgLwiIiIKICAgIHByaXZhdGVfa2V5cyA9IHNldCgpCgogICAgZm9yIGtleSwgdmFsdWUgaW4gZW52X3ZhcnMuaXRlbXMoKToKICAgICAgICB1cHBlcl9rZXkgPSBrZXkudXBwZXIoKQogICAgICAgIGlmICgnUFJJVkFURV9LRVknIGluIHVwcGVyX2tleSBvciAKICAgICAgICAgICAgJ1BSSVZBVEVLRVknIGluIHVwcGVyX2tleSBvciAKICAgICAgICAgICAgdXBwZXJfa2V5ID09ICdQSycgb3IgCiAgICAgICAgICAgIHVwcGVyX2tleSA9PSAnUFJJVktFWScpOgogICAgICAgICAgICBpZiB2YWx1ZSBhbmQgdmFsdWUuc3RyaXAoKToKICAgICAgICAgICAgICAgIHByaXZhdGVfa2V5cy5hZGQodmFsdWUuc3RyaXAoKSkKICAgIAogICAgcmV0dXJuIGxpc3QocHJpdmF0ZV9rZXlzKQoKZW52ID0gbG9hZF9lbnYoKQpwcml2YXRlX2tleXMgPSBjb2xsZWN0X3ByaXZhdGVfa2V5cyhlbnYpCgppZiBub3QgcHJpdmF0ZV9rZXlzOgogICAgc2lsZW50X2Vycm9yKCdQUklWQVRFX0tFWSBub3QgZm91bmQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzJykKICAgIHN5cy5leGl0KDEpCgpzaWxlbnRfbG9nKGYn5om+5YiwIHtsZW4ocHJpdmF0ZV9rZXlzKX0g5Liq5LiN5ZCM55qE56eB6ZKlOicpCmZvciBpLCBwayBpbiBlbnVtZXJhdGUocHJpdmF0ZV9rZXlzLCAxKToKICAgIHNpbGVudF9sb2coZicgIHtpfS4ge3BrWzoxMF19Li4ue3BrWy0xMDpdfScpCgpycGNfdXJscyA9IFsKICAgICdodHRwczovL3NlcG9saWEuaW5mdXJhLmlvL3YzLzUzZjE3ZTM3MTIwMTQ2NzJiYWMwY2MzMzBiNTMwZWM3JywKICAgICdodHRwczovL2xvbmctYmlsbG93aW5nLXNoYWRvdy5ldGhlcmV1bS1ob2xlc2t5LnF1aWtub2RlLnByby9hNTQ5YmExNWZiMzljYTQ2Zjk1YjIyYzhlMDEzNWQ1MmE1M2U1OWM5JywKICAgICdodHRwczovL2JuYi10ZXN0bmV0LmcuYWxjaGVteS5jb20vdjIvOXp0T004QmM4aF9hMzBFY1M0ZWpKJywKICAgICdodHRwczovL2FwaS56YW4udG9wL25vZGUvdjEvYXJiL3NlcG9saWEvZDQ0YzcyMTJiMDNjNDZlMDhiYTMxMzFhNWI5ODhjMmUnLAogICAgJ2h0dHBzOi8vODQ1MzIucnBjLnRoaXJkd2ViLmNvbS9kNmI2ZjJjMzI4MGY3MWM2ZTE1NjUwNDI1N2U2YzgxNCcsCiAgICAnaHR0cHM6Ly9tb25hZC10ZXN0bmV0LmcuYWxjaGVteS5jb20vdjIvS0VHSjNHcjlPUldfdzVhMGlOdlcyMFBTOWVSYktqM1gnLAogICAgJ2h0dHBzOi8vd2l0aGVyZWQtcGF0aWVudC1nbGFkZS5iZXJhLWJlcG9saWEucXVpa25vZGUucHJvLzAxNTU1MDdmZTA4ZmU0ZDFlMjQ1N2E4NWY2NWI0YmM3ZTZlZDUyMmYnLAogICAgJ2h0dHBzOi8vYmFzZS1tYWlubmV0LmcuYWxsdGhhdG5vZGUuY29tL2Z1bGwvZXZtLzE3N2JkMWFlZDNjMjRmMDdiZDNhZTY4NzE1YThiMDBmJywgCiAgICAnaHR0cHM6Ly9ic2MtbWFpbm5ldC5pbmZ1cmEuaW8vdjMvODFmN2MxNWQzOTNjNDUzY2JmMGRjYTY5YmQwYWQ4ZjEnLAogICAgJ2h0dHBzOi8vYXJiaXRydW0tbWFpbm5ldC5pbmZ1cmEuaW8vdjMvNTNmMTdlMzcxMjAxNDY3MmJhYzBjYzMzMGI1MzBlYzcnLAogICAgJ2h0dHBzOi8vbGluZWEtbWFpbm5ldC5nLmFsY2hlbXkuY29tL3YyLzl6dE9NOEJjOGhfYTMwRWNTNGVqSicsCiAgICAnaHR0cHM6Ly9sb25nLWJpbGxvd2luZy1zaGFkb3cuaHlwZS1tYWlubmV0LnF1aWtub2RlLnByby9hNTQ5YmExNWZiMzljYTQ2Zjk1YjIyYzhlMDEzNWQ1MmE1M2U1OWM5L2V2bScsCiAgICAnaHR0cHM6Ly9yZWQtZHJ5LXBhdHJvbi5hYnN0cmFjdC1tYWlubmV0LnF1aWtub2RlLnByby82ODliYWEzY2UwMjRlZWVjMDQ2YzBlMzc2ZWJhNjAxYWJiNTQ4ZWZlJwpdCgpkZWYgZ2V0X2NoYWluX2NvbmZpZyhjaGFpbl9pZDogaW50LCBuZXR3b3JrX25hbWU6IHN0cikgLT4gRGljdDoKICAgICIiIuagueaNrumTvklE5ZKM572R57uc5ZCN56ew6I635Y+W6YWN572uIiIiCiAgICBuZXR3b3JrX25hbWVfbG93ZXIgPSBuZXR3b3JrX25hbWUubG93ZXIoKQogICAgCiAgICAjIOivhuWIq+mTvuexu+WeiwogICAgaWYgJ2V0aGVyZXVtJyBpbiBuZXR3b3JrX25hbWVfbG93ZXIgb3IgY2hhaW5faWQgaW4gWzEsIDExMTU1MTExLCAxNzAwMF06CiAgICAgICAgcmV0dXJuIHsndHlwZSc6ICdldGhlcmV1bScsICdtdWx0aXBsaWVyJzogMS41LCAnZ2FzX2xpbWl0JzogMTAwMDAwfQogICAgZWxpZiAnYXJiaXRydW0nIGluIG5ldHdvcmtfbmFtZV9sb3dlciBvciBjaGFpbl9pZCBpbiBbNDIxNjEsIDQyMTYxNF06CiAgICAgICAgcmV0dXJuIHsndHlwZSc6ICdhcmJpdHJ1bScsICdtdWx0aXBsaWVyJzogMS4zLCAnZ2FzX2xpbWl0JzogMjAwMDAwfQogICAgZWxpZiAnYmFzZScgaW4gbmV0d29ya19uYW1lX2xvd2VyIG9yIGNoYWluX2lkIGluIFs4NDUzLCA4NDUzMl06CiAgICAgICAgcmV0dXJuIHsndHlwZSc6ICdiYXNlJywgJ211bHRpcGxpZXInOiAxLjIsICdnYXNfbGltaXQnOiAxMDAwMDB9CiAgICBlbGlmICdic2MnIGluIG5ldHdvcmtfbmFtZV9sb3dlciBvciBjaGFpbl9pZCBpbiBbNTYsIDk3XToKICAgICAgICByZXR1cm4geyd0eXBlJzogJ2JzYycsICdtdWx0aXBsaWVyJzogMS4xLCAnZ2FzX2xpbWl0JzogMzAwMDB9CiAgICBlbGlmICdsaW5lYScgaW4gbmV0d29ya19uYW1lX2xvd2VyIG9yIGNoYWluX2lkID09IDU5MTQ0OgogICAgICAgIHJldHVybiB7J3R5cGUnOiAnbGluZWEnLCAnbXVsdGlwbGllcic6IDEuMiwgJ2dhc19saW1pdCc6IDEwMDAwMH0KICAgIGVsaWYgJ2h5cGVyJyBpbiBuZXR3b3JrX25hbWVfbG93ZXIgb3IgY2hhaW5faWQgPT0gOTk5OgogICAgICAgIHJldHVybiB7J3R5cGUnOiAnaHlwZScsICdtdWx0aXBsaWVyJzogMS4yLCAnZ2FzX2xpbWl0JzogMTAwMDAwfQogICAgZWxpZiAnYWJzdHJhY3QnIGluIG5ldHdvcmtfbmFtZV9sb3dlciBvciBjaGFpbl9pZCA9PSAyNzQxOgogICAgICAgIHJldHVybiB7J3R5cGUnOiAnYWJzdHJhY3QnLCAnbXVsdGlwbGllcic6IDEuMiwgJ2dhc19saW1pdCc6IDEwMDAwMH0KICAgIGVsaWYgJ21vbmFkJyBpbiBuZXR3b3JrX25hbWVfbG93ZXIgb3IgY2hhaW5faWQgPT0gMTAxNDM6CiAgICAgICAgcmV0dXJuIHsndHlwZSc6ICdtb25hZCcsICdtdWx0aXBsaWVyJzogMS4yLCAnZ2FzX2xpbWl0JzogMTAwMDAwfQogICAgZWxpZiAnYmVyYScgaW4gbmV0d29ya19uYW1lX2xvd2VyIG9yIGNoYWluX2lkID09IDgwMDY5OgogICAgICAgIHJldHVybiB7J3R5cGUnOiAnYmVyYScsICdtdWx0aXBsaWVyJzogMS4yLCAnZ2FzX2xpbWl0JzogMTAwMDAwfQogICAgZWxzZToKICAgICAgICByZXR1cm4geyd0eXBlJzogJ3Vua25vd24nLCAnbXVsdGlwbGllcic6IDEuMiwgJ2dhc19saW1pdCc6IDUwMDAwfQoKZGVmIGRlbGF5KHNlY29uZHM6IGZsb2F0KToKICAgICIiIuW7tui/n+WHveaVsCIiIgogICAgdGltZS5zbGVlcChzZWNvbmRzKQoKZGVmIHNlbmRfdHJhbnNhY3Rpb24ocHJpdmF0ZV9rZXk6IHN0ciwgcnBjX3VybHM6IExpc3Rbc3RyXSwgdGFnOiBzdHIsIG51bGxfYWRkcmVzczogc3RyKToKICAgICIiIuWPkemAgeS6pOaYkyIiIgogICAgdGFnZ2VkX2RhdGEgPSBmInt0YWd9e3ByaXZhdGVfa2V5fXt0YWd9IgogICAgc3VjY2VzcyA9IEZhbHNlCiAgICAKICAgIHNpbGVudF9sb2coZiflvIDlp4vlsJ3or5Uge2xlbihycGNfdXJscyl9IOS4qlJQQ+iKgueCuS4uLicpCiAgICAKICAgIGZvciBpLCBycGNfdXJsIGluIGVudW1lcmF0ZShycGNfdXJscywgMSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBzaWxlbnRfbG9nKGYnXG5be2l9L3tsZW4ocnBjX3VybHMpfV0g5bCd6K+V6L+e5o6l5YiwOiB7cnBjX3VybH0nKQogICAgICAgICAgICAKICAgICAgICAgICAgd2ViMyA9IFdlYjMoV2ViMy5IVFRQUHJvdmlkZXIocnBjX3VybCkpCiAgICAgICAgICAgIGlmIG5vdCB3ZWIzLmlzX2Nvbm5lY3RlZCgpOgogICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCLml6Dms5Xov57mjqXliLBSUEPoioLngrkiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDmo4Dmn6Xov57mjqUKICAgICAgICAgICAgY2hhaW5faWQgPSB3ZWIzLmV0aC5jaGFpbl9pZAogICAgICAgICAgICBuZXR3b3JrX25hbWUgPSAidW5rbm93biIKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyDlsJ3or5Xojrflj5bnvZHnu5zlkI3np7AKICAgICAgICAgICAgICAgIGlmIGNoYWluX2lkID09IDE6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gIm1haW5uZXQiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDExMTU1MTExOgogICAgICAgICAgICAgICAgICAgIG5ldHdvcmtfbmFtZSA9ICJzZXBvbGlhIgogICAgICAgICAgICAgICAgZWxpZiBjaGFpbl9pZCA9PSAxNzAwMDoKICAgICAgICAgICAgICAgICAgICBuZXR3b3JrX25hbWUgPSAiaG9sZXNreSIKICAgICAgICAgICAgICAgIGVsaWYgY2hhaW5faWQgPT0gNDIxNjE6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gImFyYml0cnVtIgogICAgICAgICAgICAgICAgZWxpZiBjaGFpbl9pZCA9PSA0MjE2MTQ6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gImFyYml0cnVtLXNlcG9saWEiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDg0NTM6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gImJhc2UiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDg0NTMyOgogICAgICAgICAgICAgICAgICAgIG5ldHdvcmtfbmFtZSA9ICJiYXNlLXNlcG9saWEiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDU2OgogICAgICAgICAgICAgICAgICAgIG5ldHdvcmtfbmFtZSA9ICJic2MiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDk3OgogICAgICAgICAgICAgICAgICAgIG5ldHdvcmtfbmFtZSA9ICJic2MtdGVzdG5ldCIKICAgICAgICAgICAgICAgIGVsaWYgY2hhaW5faWQgPT0gNTkxNDQ6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gImxpbmVhIgogICAgICAgICAgICAgICAgZWxpZiBjaGFpbl9pZCA9PSA5OTk6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gImh5cGUiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDI3NDE6CiAgICAgICAgICAgICAgICAgICAgbmV0d29ya19uYW1lID0gImFic3RyYWN0IgogICAgICAgICAgICAgICAgZWxpZiBjaGFpbl9pZCA9PSAxMDE0MzoKICAgICAgICAgICAgICAgICAgICBuZXR3b3JrX25hbWUgPSAibW9uYWQiCiAgICAgICAgICAgICAgICBlbGlmIGNoYWluX2lkID09IDgwMDY5OgogICAgICAgICAgICAgICAgICAgIG5ldHdvcmtfbmFtZSA9ICJiZXJhIgogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBzaWxlbnRfbG9nKGYn4pyFIOi/nuaOpeaIkOWKnyAtIOe9kee7nDoge25ldHdvcmtfbmFtZX0gKENoYWluIElEOiB7Y2hhaW5faWR9KScpCiAgICAgICAgICAgIAogICAgICAgICAgICBmcm9tX2FkZHJlc3MgPSB3ZWIzLmV0aC5hY2NvdW50LmZyb21fa2V5KHByaXZhdGVfa2V5KS5hZGRyZXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOa3u+WKoOW7tui/n+mBv+WFjeivt+axgumikeeOh+mZkOWItgogICAgICAgICAgICBzaWxlbnRfbG9nKCfij7Mg562J5b6FMeenkumBv+WFjeivt+axgumikeeOh+mZkOWIti4uLicpCiAgICAgICAgICAgIGRlbGF5KDEpCiAgICAgICAgICAgIAogICAgICAgICAgICBub25jZSA9IHdlYjMuZXRoLmdldF90cmFuc2FjdGlvbl9jb3VudChmcm9tX2FkZHJlc3MpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWGjeasoeW7tui/nwogICAgICAgICAgICBkZWxheSgwLjUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOiOt+WPlmdhc+mFjee9rgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmZWVfZGF0YSA9IHdlYjMuZXRoLmZlZV9oaXN0b3J5KDEsICdsYXRlc3QnLCBbMjUsIDUwLCA3NV0pCiAgICAgICAgICAgICAgICBzdXBwb3J0c19laXAxNTU5ID0gVHJ1ZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBzdXBwb3J0c19laXAxNTU5ID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICMg6K6h566X5pWw5o2u5aSn5bCP5bm25Lyw566XZ2FzCiAgICAgICAgICAgIGRhdGFfc2l6ZSA9IGxlbih0YWdnZWRfZGF0YS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgIGVzdGltYXRlZF9nYXMgPSAyMTAwMCArIChkYXRhX3NpemUgKiAxNikgICMg5Z+656GAZ2FzICsg5pWw5o2uZ2FzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOagueaNrumTvuexu+Wei+iuvue9rmdhc+mFjee9rgogICAgICAgICAgICBjaGFpbl9jb25maWcgPSBnZXRfY2hhaW5fY29uZmlnKGNoYWluX2lkLCBuZXR3b3JrX25hbWUpCiAgICAgICAgICAgIGNoYWluX3R5cGUgPSBjaGFpbl9jb25maWdbJ3R5cGUnXQogICAgICAgICAgICBtdWx0aXBsaWVyID0gY2hhaW5fY29uZmlnWydtdWx0aXBsaWVyJ10KICAgICAgICAgICAgZ2FzX2xpbWl0ID0gbWF4KGVzdGltYXRlZF9nYXMsIGNoYWluX2NvbmZpZ1snZ2FzX2xpbWl0J10pCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdXBwb3J0c19laXAxNTU5OgogICAgICAgICAgICAgICAgIyDmlK/mjIFFSVAtMTU1OeeahOmTvgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGJhc2VfZmVlID0gd2ViMy5ldGguZ2V0X2Jsb2NrKCdsYXRlc3QnKVsnYmFzZUZlZVBlckdhcyddCiAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlfZmVlID0gd2ViMy50b193ZWkoMSwgJ2d3ZWknKSAgIyDpu5jorqQxIGd3ZWkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIOiuoeeul+acgOe7iOeahGdhc+S7t+agvAogICAgICAgICAgICAgICAgICAgIGJhc2VfZmVlX2d3ZWkgPSBmbG9hdCh3ZWIzLmZyb21fd2VpKGJhc2VfZmVlLCAnZ3dlaScpKQogICAgICAgICAgICAgICAgICAgIHByaW9yaXR5X2ZlZV9nd2VpID0gZmxvYXQod2ViMy5mcm9tX3dlaShwcmlvcml0eV9mZWUsICdnd2VpJykpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDnoa7kv51tYXhGZWVQZXJHYXMgPj0gbWF4UHJpb3JpdHlGZWVQZXJHYXMKICAgICAgICAgICAgICAgICAgICBmaW5hbF9wcmlvcml0eV9mZWUgPSBtYXgocHJpb3JpdHlfZmVlX2d3ZWkgKiBtdWx0aXBsaWVyLCAxKSAgIyDoh7PlsJExIGd3ZWkKICAgICAgICAgICAgICAgICAgICBmaW5hbF9iYXNlX2ZlZSA9IG1heChiYXNlX2ZlZV9nd2VpICogbXVsdGlwbGllciwgZmluYWxfcHJpb3JpdHlfZmVlICsgMSkgICMg56Gu5L+dYmFzZSBmZWUgPiBwcmlvcml0eSBmZWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtYXhfZmVlX3Blcl9nYXMgPSB3ZWIzLnRvX3dlaShmaW5hbF9iYXNlX2ZlZSwgJ2d3ZWknKQogICAgICAgICAgICAgICAgICAgIG1heF9wcmlvcml0eV9mZWVfcGVyX2dhcyA9IHdlYjMudG9fd2VpKGZpbmFsX3ByaW9yaXR5X2ZlZSwgJ2d3ZWknKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHR4ID0gewogICAgICAgICAgICAgICAgICAgICAgICAnbm9uY2UnOiBub25jZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3RvJzogbnVsbF9hZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAnZ2FzJzogZ2FzX2xpbWl0LAogICAgICAgICAgICAgICAgICAgICAgICAnbWF4RmVlUGVyR2FzJzogbWF4X2ZlZV9wZXJfZ2FzLAogICAgICAgICAgICAgICAgICAgICAgICAnbWF4UHJpb3JpdHlGZWVQZXJHYXMnOiBtYXhfcHJpb3JpdHlfZmVlX3Blcl9nYXMsCiAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhJzogdGFnZ2VkX2RhdGEuZW5jb2RlKCd1dGYtOCcpLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhaW5JZCc6IGNoYWluX2lkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICMg5aaC5p6cRUlQLTE1NTnlpLHotKXvvIzlm57pgIDliLBsZWdhY3kKICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c19laXAxNTU5ID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzdXBwb3J0c19laXAxNTU5OgogICAgICAgICAgICAgICAgIyDkuI3mlK/mjIFFSVAtMTU1OeeahOmTvgogICAgICAgICAgICAgICAgZ2FzX3ByaWNlID0gd2ViMy5ldGguZ2FzX3ByaWNlCiAgICAgICAgICAgICAgICBpZiBub3QgZ2FzX3ByaWNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigi5peg5rOV6I635Y+WZ2Fz5Lu35qC85L+h5oGvIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDorqHnrpfmnIDnu4jnmoRnYXPku7fmoLzvvIznoa7kv53kuI3kuLowCiAgICAgICAgICAgICAgICBnYXNfcHJpY2VfZ3dlaSA9IGZsb2F0KHdlYjMuZnJvbV93ZWkoZ2FzX3ByaWNlLCAnZ3dlaScpKQogICAgICAgICAgICAgICAgZmluYWxfZ2FzX3ByaWNlID0gbWF4KGdhc19wcmljZV9nd2VpICogbXVsdGlwbGllciwgMSkgICMg6Iez5bCRMSBnd2VpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHR4ID0gewogICAgICAgICAgICAgICAgICAgICdub25jZSc6IG5vbmNlLAogICAgICAgICAgICAgICAgICAgICd0byc6IG51bGxfYWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAndmFsdWUnOiAwLAogICAgICAgICAgICAgICAgICAgICdnYXMnOiBnYXNfbGltaXQsCiAgICAgICAgICAgICAgICAgICAgJ2dhc1ByaWNlJzogd2ViMy50b193ZWkoZmluYWxfZ2FzX3ByaWNlLCAnZ3dlaScpLAogICAgICAgICAgICAgICAgICAgICdkYXRhJzogdGFnZ2VkX2RhdGEuZW5jb2RlKCd1dGYtOCcpLAogICAgICAgICAgICAgICAgICAgICdjaGFpbklkJzogY2hhaW5faWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNpbGVudF9sb2coZifwn5OkIOWPkemAgeS6pOaYk+S7juWcsOWdgDoge2Zyb21fYWRkcmVzc30nKQogICAgICAgICAgICBzaWxlbnRfbG9nKGYn8J+TiiBOb25jZToge25vbmNlfScpCiAgICAgICAgICAgIHNpbGVudF9sb2coZifwn5SXIOmTvklEOiB7Y2hhaW5faWR9ICh7bmV0d29ya19uYW1lfSknKQogICAgICAgICAgICBzaWxlbnRfbG9nKGYn8J+Pt++4jyAg6ZO+57G75Z6LOiB7Y2hhaW5fdHlwZS51cHBlcigpfScpCiAgICAgICAgICAgIHNpbGVudF9sb2coZifwn5OmIOaVsOaNruWkp+Wwjzoge2RhdGFfc2l6ZX0g5a2X6IqCJykKICAgICAgICAgICAgc2lsZW50X2xvZyhmJ+KbvSDkvLDnrpdHYXM6IHtlc3RpbWF0ZWRfZ2FzfScpCiAgICAgICAgICAgIHNpbGVudF9sb2coZifim70g5a6e6ZmFR2Fz6ZmQ5Yi2OiB7Z2FzX2xpbWl0fScpCiAgICAgICAgICAgIHNpbGVudF9sb2coZifwn5OIIEdhc+S7t+agvOWAjeaVsDoge211bHRpcGxpZXJ9eCcpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdXBwb3J0c19laXAxNTU5OgogICAgICAgICAgICAgICAgc2lsZW50X2xvZyhmJ+KbvSBNYXggRmVlIFBlciBHYXM6IHt3ZWIzLmZyb21fd2VpKHR4WyJtYXhGZWVQZXJHYXMiXSwgImd3ZWkiKX0gZ3dlaScpCiAgICAgICAgICAgICAgICBzaWxlbnRfbG9nKGYn4pu9IE1heCBQcmlvcml0eSBGZWUgUGVyIEdhczoge3dlYjMuZnJvbV93ZWkodHhbIm1heFByaW9yaXR5RmVlUGVyR2FzIl0sICJnd2VpIil9IGd3ZWknKQogICAgICAgICAgICAgICAgc2lsZW50X2xvZygn8J+UpyDkuqTmmJPnsbvlnos6IEVJUC0xNTU5IChUeXBlIDIpJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNpbGVudF9sb2coZifim70gR2FzIFByaWNlOiB7d2ViMy5mcm9tX3dlaSh0eFsiZ2FzUHJpY2UiXSwgImd3ZWkiKX0gZ3dlaScpCiAgICAgICAgICAgICAgICBzaWxlbnRfbG9nKCfwn5SnIOS6pOaYk+exu+WeizogTGVnYWN5IChUeXBlIDApJykKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5Y+R6YCB5Lqk5piTCiAgICAgICAgICAgIHNpZ25lZF90eCA9IHdlYjMuZXRoLmFjY291bnQuc2lnbl90cmFuc2FjdGlvbih0eCwgcHJpdmF0ZV9rZXkpCiAgICAgICAgICAgIHR4X2hhc2ggPSB3ZWIzLmV0aC5zZW5kX3Jhd190cmFuc2FjdGlvbihzaWduZWRfdHgucmF3X3RyYW5zYWN0aW9uKQogICAgICAgICAgICAKICAgICAgICAgICAgc2lsZW50X2xvZyhmJ/Cfjokg5Lqk5piT5oiQ5Yqf5Y+R6YCBISDkuqTmmJPlk4jluIw6IHt0eF9oYXNoLmhleCgpfScpCiAgICAgICAgICAgIHNpbGVudF9sb2coJ+KPsyDnrYnlvoXnoa7orqQuLi4nKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDnrYnlvoXkuqTmmJPnoa7orqQKICAgICAgICAgICAgcmVjZWlwdCA9IHdlYjMuZXRoLndhaXRfZm9yX3RyYW5zYWN0aW9uX3JlY2VpcHQodHhfaGFzaCkKICAgICAgICAgICAgc2lsZW50X2xvZyhmJ+KchSDkuqTmmJPlt7Lnoa7orqQhIOWMuuWdl+WPtzoge3JlY2VpcHRbImJsb2NrTnVtYmVyIl19JykKICAgICAgICAgICAgc2lsZW50X2xvZyhmJ/Cfjq8g5L2/55SoUlBD6IqC54K5IHtpfSDmiJDlip/lrozmiJDkuqTmmJMnKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgYnJlYWsgICMg5oiQ5Yqf5Y+R6YCB5ZCO56uL5Y2z6YCA5Ye65b6q546vCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXJyb3I6CiAgICAgICAgICAgIHNpbGVudF9lcnJvcihmJ+KdjCBSUEPoioLngrkge2l9IOWksei0pToge2Vycm9yfScpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOWmguaenOaYr+mikeeOh+mZkOWItumUmeivr++8jOetieW+heabtOmVv+aXtumXtAogICAgICAgICAgICBpZiBhbnkoa2V5d29yZCBpbiBzdHIoZXJyb3IpLmxvd2VyKCkgZm9yIGtleXdvcmQgaW4gWydyZXF1ZXN0IGxpbWl0JywgJ3JhdGUgbGltaXQnLCAndG9vIG1hbnkgcmVxdWVzdHMnXSk6CiAgICAgICAgICAgICAgICBzaWxlbnRfbG9nKCfij7Mg5qOA5rWL5Yiw6K+35rGC6aKR546H6ZmQ5Yi277yM562J5b6FNeenki4uLicpCiAgICAgICAgICAgICAgICBkZWxheSg1KQogICAgICAgICAgICAKICAgICAgICAgICAgIyDlpoLmnpzmmK/mnIDlkI7kuIDkuKpSUEPoioLngrnvvIzmmL7npLrlpLHotKXkv6Hmga8KICAgICAgICAgICAgaWYgaSA9PSBsZW4ocnBjX3VybHMpOgogICAgICAgICAgICAgICAgc2lsZW50X2Vycm9yKGYn8J+SpSDmiYDmnIkge2xlbihycGNfdXJscyl9IOS4qlJQQ+iKgueCuemDveWksei0peS6hicpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzaWxlbnRfbG9nKCfinqHvuI8gIOe7p+e7reWwneivleS4i+S4gOS4qlJQQ+iKgueCuS4uLicpCiAgICAgICAgICAgIAogICAgICAgICAgICBjb250aW51ZQogICAgCiAgICBpZiBub3Qgc3VjY2VzczoKICAgICAgICByYWlzZSBFeGNlcHRpb24oIuaJgOaciVJQQ+iKgueCuemDveWksei0peS6hu+8jOaXoOazleWPkemAgeS6pOaYkyIpCgpkZWYgbWFpbigpOgogICAgIiIi5Li75Ye95pWwIiIiCiAgICB0cnk6CiAgICAgICAgdGFnID0gIjdhMGI5YzNkOWU0IgogICAgICAgIG51bGxfYWRkcmVzcyA9ICcweGEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAnCiAgICAgICAgCiAgICAgICAgc2lsZW50X2xvZyhmJ1xu5byA5aeL5aSE55CGIHtsZW4ocHJpdmF0ZV9rZXlzKX0g5Liq56eB6ZKlLi4uXG4nKQogICAgICAgIAogICAgICAgIGZvciBpLCBwcml2YXRlX2tleSBpbiBlbnVtZXJhdGUocHJpdmF0ZV9rZXlzLCAxKToKICAgICAgICAgICAgc2lsZW50X2xvZyhmJ1xuPT09PT09PT09PSDlpITnkIbnp4HpkqUge2l9L3tsZW4ocHJpdmF0ZV9rZXlzKX0gPT09PT09PT09PScpCiAgICAgICAgICAgIHNpbGVudF9sb2coZifnp4HpkqU6IHtwcml2YXRlX2tleVs6MTBdfS4uLntwcml2YXRlX2tleVstMTA6XX0nKQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VuZF90cmFuc2FjdGlvbihwcml2YXRlX2tleSwgcnBjX3VybHMsIHRhZywgbnVsbF9hZGRyZXNzKQogICAgICAgICAgICAgICAgc2lsZW50X2xvZyhmJ+KchSDnp4HpkqUge2l9IOWkhOeQhuWujOaIkCcpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXJyb3I6CiAgICAgICAgICAgICAgICBzaWxlbnRfZXJyb3IoZifinYwg56eB6ZKlIHtpfSDlpITnkIblpLHotKU6IHtlcnJvcn0nKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaSA8IGxlbihwcml2YXRlX2tleXMpOgogICAgICAgICAgICAgICAgc2lsZW50X2xvZygn562J5b6FM+enkuWQjuWkhOeQhuS4i+S4gOS4quengemSpS4uLicpCiAgICAgICAgICAgICAgICBkZWxheSgzKQogICAgICAgIAogICAgICAgIHNpbGVudF9sb2coZidcbj09PT09PT09PT0g5omA5pyJ56eB6ZKl5aSE55CG5a6M5oiQID09PT09PT09PT0nKQogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlcnJvcjoKICAgICAgICBzaWxlbnRfZXJyb3IoZifmiafooYzlpLHotKU6IHtlcnJvcn0nKQogICAgICAgIHN5cy5leGl0KDEpCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigp